<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Pathogen Genomics Week - March 2024 - SESSION 5 - Data integration with Data-flo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/cgps.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Pathogen Genomics Week - March 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../agenda.html" rel="" target="">
 <span class="menu-text">Agenda</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Syllabus.html" rel="" target="">
 <span class="menu-text">Digital Epidemiology</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../bioinformatics.html" rel="" target="">
 <span class="menu-text">Bioinformatics</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-training-materials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Training materials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-training-materials">    
        <li>
    <a class="dropdown-item" href="../module1/module1.html" rel="" target="">
 <span class="dropdown-text">SESSION 1 - Digital Epidemiologist’s Toolbox - theory</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../module2/module2.html" rel="" target="">
 <span class="dropdown-text">SESSION 2 - Introduction to the CGPS tools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../module3/module3.html" rel="" target="">
 <span class="dropdown-text">SESSION 3 - Introduction to Trimming, Assembly and QC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../module4/module4.html" rel="" target="">
 <span class="dropdown-text">SESSION 4 - Genome Analysis with Pathogenwatch</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../module5/module5.html" rel="" target="">
 <span class="dropdown-text">SESSION 5 - Data integration with Data-flo</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../module6/module6.html" rel="" target="">
 <span class="dropdown-text">SESSION 6 - Data visualisation and Interpretation with Microreact</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../resources.html" rel="" target="">
 <span class="dropdown-text">Resources</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SESSION 5 - Data integration with Data-flo</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="module-leads-julio-diaz-caballero-natacha-couto-georgina-lewis-woodhouse-emmanuelle-kumaran-nabil-fareed-alikhan-sophia-david-monica-abrudan" class="level3">
<h3 class="anchored" data-anchor-id="module-leads-julio-diaz-caballero-natacha-couto-georgina-lewis-woodhouse-emmanuelle-kumaran-nabil-fareed-alikhan-sophia-david-monica-abrudan">Module Leads: Julio Diaz Caballero, Natacha Couto, Georgina Lewis-Woodhouse, Emmanuelle Kumaran, Nabil Fareed-Alikhan, Sophia David, Monica Abrudan</h3>
<section id="based-on-the-exercise-developed-by-silvia-argimon" class="level4">
<h4 class="anchored" data-anchor-id="based-on-the-exercise-developed-by-silvia-argimon"><strong><em>based on the exercise developed by Silvia Argimon</em></strong></h4>
</section>
</section>
<section id="table-of-contents" class="level1">
<h1>Table of contents</h1>
<ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#learning-outcomes">Objectives</a></li>
<li><a href="#data-flow">Data integration with Data-flo</a></li>
<li><a href="#sign-in-to-data-flo">Sign-in to data-flo</a></li>
</ul>
</section>
<section id="intro" class="level1">
<h1>Introduction</h1>
<p>Data-flo (<a href="https://next.data-flo.io/" class="uri">https://next.data-flo.io/</a>) is a system for customised integration and manipulation of diverse data via a simple drag and drop interface.**</p>
<p>For Data-flo documentation, go to <a href="https://docs.data-flo.io/introduction/readme" class="uri">https://docs.data-flo.io/introduction/readme</a>.</p>
<p>Data-flo can easily combine epidemiological data, genomic data, laboratory data, and various metadata from disparate sources (i.e., different data systems) and formats.</p>
<p>Data-flo provides a visual method to design a reusable workflows to integrate, clean, and manipulate data in a multitude of ways, eliminating the need for continuous manual intervention (e.g., coding, formatting, spreadsheet formulas, manual copy-pasting).</p>
<p>Data-flo workflows are combinations of ready-to-use data adaptors that can be tailored, modularised and shared for reuse and reproducibility. Once a Data-flo workflow has been created, it can be run anytime, by anyone with access, to enable push-button data extraction and transformation. This saves significant time by removing the bulk of the manual repetitive workflows that require multiple sequential or tedious steps, enabling practitioners to focus on analysis and interpretation.</p>
</section>
<section id="learning-outcomes" class="level1">
<h1>Objectives</h1>
<p>At the end of this session the participants will be able to:</p>
<ol type="1">
<li>Build a data transformation workflow by combining ready-to-use data adaptors suited to the exercise</li>
<li>Acquire a Microreact link that combines all the data files from the exercise using Data-flo</li>
</ol>
</section>
<section id="data-flow" class="level1">
<h1>Data integration with Data-flo</h1>
<p><code>https://data-flo.io/</code></p>
<p><em>Note: you need to sign-up for Data-flo and Microreact. See instructions in the <a href="#resources">Resources</a> section. Creating your own account will allow you to manage and edit your projects.</em></p>
<p>A cgSNP tree was generated through Pathogenwatch (<a href="https://drive.google.com/file/d/1R8nyAXNaiGIBL-2u30sD-W5Ajy-VNUeR/view?usp=drive_link"><code>tree.nwk</code></a>). Contextual genomes present in Pathogenwatch (Jan 2020-now) were also included in the tree inference and their associated data added to the <a href="https://drive.google.com/file/d/1J9n1bM_527OCWEq6_6XQf7sheE-XL8Ol/view?usp=drive_link"><code>epi_data.csv</code></a> file.</p>
<p>The user now has the information needed for the investigation in the following formats:</p>
<ul>
<li><a href="https://drive.google.com/file/d/13HD8-XOAGDftpxGlyk4GD1f_uIvPZ54R/view?usp=sharing"><code>epi_data.csv</code></a> Epi data from 3 clinical cases, 6 carriers and 11 environmental samples</li>
<li><a href="https://docs.google.com/spreadsheets/d/153bF5JcYkRcxxMEitsu0P7kTyvhE_VLw/edit?usp=drive_link&amp;ouid=112034429986883609176&amp;rtpof=true&amp;sd=true"><code>lab_results.xlsx</code></a> Culture and AST results</li>
<li><a href="https://drive.google.com/file/d/1hsJFZjzaWFUWeRhkU8H7rfnabcyxDCRR/view?usp=drive_link"><code>PW_metadata.csv</code></a> metadata results from Pathogenwatch</li>
<li><a href="https://drive.google.com/file/d/1qC32dWw3ClUdFpK0LsTn3-nBazXxtpul/view?usp=drive_link">PW_Kleborate.csv</a> Kleborate file from Pathogenwatch</li>
<li><a href="https://drive.google.com/file/d/1d4KnpHY6rVKV6spwy9bBMeV3wnHwuJoj/view?usp=drive_link"><code>tree.nwk</code></a> cgSNP tree of 7 Kpn genomes</li>
</ul>
<p>The files are located in <a href="https://drive.google.com/drive/folders/18L-t-xTWaURNITyiefqFsKBr26T0AHEK"><strong>this link</strong></a>.</p>
<p>We will create a Data-flo workflow to consolidate the files and send them to Microreact for visualisation. Follow the steps below:</p>
<p>1) <u>Start a new workflow</u>: on the Workflows page click the purple on the button right of the screen and select “Create new Workflow”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/new_workflow.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>2) This is your canvas. On the left you have the canvas on which you will build your workflow. On the right panel you have the list of all the adaptors you can use to build your Workflow.&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/canvas.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>It is good practice to start by naming your workflow. To do so click on the “Untitled Workflow” text on the top left.</p>
<p>3) To import the Epidemiology data, which is in a CSV file, you can use the <strong><code>import from csv file</code></strong> adaptor. You can find it on the left panel by going through the list of adaptors and selecting the appropriate option. Alternatively, you can use the search feature on the top of the adaptor panel to quickly find the adaptor you need.&nbsp;</p>
<p>Once you have found the adaptor, click on the file input and select “Data-flo input” on the right panel. This option allows the user to add the CSV file when they run the workflow on the Run page.</p>
<p>A drop down menu will appear, select “create new input”&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/import_csv.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>4) Click on the input data diamond. You can rename the input data name and add a short description to give the user more context as to which file to add. You can also add the CSV to the test run value, this will allow you to test your workflow with a data file as you build it. You can then click the “play” button on the top left of the screen to test run your workflow. It is good practice to do this, each time you add a new adaptor. If the adapter turns red, something has gone wrong with the adaptor setup.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/input_file.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>Add latitude and longitudes to the Epidemiological data:</strong>&nbsp;</p>
<p>5) Because the hospital name is not specific, we can use the concatenate column, to merge the City and Hospital columns. Firstly, select <code>concatenate column</code> from the list of adaptors. Then, connect the data output from the “import from csv file” to the data input in the “concatenate column” adaptor. Click on the “columns” option and select “Define value”. Add the names of the two columns you want to merge. In the separator input option on the adaptor, you can also add a separator (for example, a comma) to separate the values from the two concatenated columns. Finally, in the concatenated column input option, add the name of the new column which will contain the concatenated values.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/concatenate_columns.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>6) Add the <strong><code>geocoding</code></strong> adaptor to your workflow. Under the location column input option, enter your concatenated column. This adaptor will create columns named latitude and longitude by default. However, you can choose to name these columns differently by using the latitude column and longitude column input options.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/geocoding.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>7) Import the lab data into your Workflow. You can do this using the <strong><code>import from excel file</code></strong> adaptor. Follow the same instruction for setting up this adaptor as 3) and 4)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/import_from_csv_file.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>8) The laboratory data includes samples that are both culture positive and negative. However, for our current workflow, we are only interested in the culture positive samples. To filter out the culture negative samples, we can use the <code>filter rows</code> adaptor. First, we need to specify the name of the column we want to search, which in this case is the culture column. Next, we need to specify the value to be filtered on, for example, Klebsiella pneumoniae. After filtering, we will get two output datatables. One will contain all the rows that include Klebsiella pneumoniae, while the other will contain all the remaining rows.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/filter rows.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>9)To combine the lab data and epidemiology data tables, you can use the <strong><code>join datatables</code></strong> adaptor. First, add the two datatables to the main and other data inputs. Then, specify which columns from each datatable should be used to perform the join. You can choose the type of join you want to perform - in this case, we want an inner join which will only keep the rows that have matching values in both tables. For more information on different types of joins, you can visit the following URL: https://www.datasciencemadesimple.com/join-in-r-merge-in-r/.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/join_datatables.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>10) Import the Pathogenwatch metadata using steps 3) and 4)</p>
<p>11) The metadata file contains several columns that are either blank or not useful. To select only the necessary columns, you can use the <code>select columns</code> adaptor. In the “column names” input, you need to define a list of columns that you want to keep in the file. In this case, you will want to keep the following columns: Name, Country, Collection date, Collected by, Isolation source, Host, Latitude, and Longitude. Note: you can also use the <code>remove columns</code> adaptor, in which case you would need to define the columns you wish to remove.&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/select_columns.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>12) Rename the metadata and joined lab and epi datatables in order to make them match. To do so, you can use the <code>rename columns</code> adaptor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/rename_columns.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Renaming the Metadata datatable: under the column names input, rename all the columns according to the table below.&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/metadata_rename.png" class="img-fluid figure-img" width="410"></p>
</figure>
</div>
<p>Renaming the joined lab/epi datatable: rename the columns according to the table below. In addition, under the discard unmapped, click the define value and select TRUE, this will discard any columns that were not renamed.&nbsp;</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/lab_epi_rename.png" class="img-fluid figure-img" width="410"></p>
</figure>
</div>
<p>13) Back to the PW metadata, you may have observed that the rows associated with the samples from University College Hospital are empty. These rows can be removed as the information for them is present in the joined lab/epi datatable. To do this, you can use the <code>filter rows</code> adaptor. Select the “collection_date” under the column name input and click on “define” under the filter type input. Then choose the “is-blank” option. Note: the data you want will be in the complementary output and not the data output</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/filter_rows_adaptor.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>14) Add a country column to the joined lab/epi datatable using the <code>add column</code> adaptor. Under the value input add Nigeria.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/add_column_adaptor.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>15) Add a “host” column to the joined lab/epi datatable using the <strong><code>map column values</code></strong> adaptor. Map the values in the “source” column to either “Human” or “Environmental”.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/map_column_values_adaptor.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>16) Append both datatables together using the “append datatables” adaptor</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/append_datatable_adaptor.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>17) Import the Kleborate CSV using steps 3) and 4)</p>
<p>18) Join the Kleborate datatable to the other datatable using the <code>join datatable</code> adaptor.</p>
<p>19) We now want to export this data to Microreact to visualise it. Before we do this. We need to convert this datatable to CSV form which can be done using the <code>export to CSV file</code> adaptor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/export_to_csv_file_adaptor.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>20) Select the <code>export to microreact</code> adaptor.</p>
<ol type="1">
<li><p>Link your CSV output of the previous adaptor to the data file input of this adaptor</p></li>
<li><p>Under the tree file input, add a new data-flo output for your tree file.</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/export_to_microreact_adaptor.jpeg" class="img-fluid figure-img"></p>
</figure>
</div>
<p><strong>On a different browser tab</strong>, get your microreact <code>API access token</code> at <a href="https://microreact.org/my-account/settings"><strong>https://microreact.org/my-account/settings</strong></a> (you must already have created your microreact account).</p>
<p>Go to the My account tab at the top of your Microreact page and then to the Account Settings. Copy your API token.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/miroreact_token.png" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
<p>Go back to your Data-flo workflow and click on <code>*access token</code> and add your API token as a defined value.</p>
<p>In the outputs of the <code>export to microreact</code> click on URL and check the “Use as Workflow Output”</p>
<section id="run-your-workflow" class="level3">
<h3 class="anchored" data-anchor-id="run-your-workflow">Run your workflow</h3>
<p>On the top right corner of your canvas, select the Run option.</p>
<p>To run the workflow upload the files named lab_results.xlsx, tree.nwk, epi_data.csv, and mlst-Pasteur.csv.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/New/run_page.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Click on <strong><code>Run</code></strong>. The Outputs box now shows the url of a Microreact project created by data-flo.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/dataflo_result.png" class="img-fluid figure-img" style="width:50.0%"></p>
</figure>
</div>
<p><strong><em>The materials provided in this repository are FREE to use.</em></strong> <strong><em>This work is licensed under a Creative Commons Attribution 4.0 International License. Reuse is encouraged with acknowledgement.</em></strong></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">This work is licensed under a Creative Commons Attribution 4.0 International License. Reuse is encouraged with acknowledgement</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/TheCGPS">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>